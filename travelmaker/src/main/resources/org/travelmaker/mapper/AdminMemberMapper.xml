<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.rog//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.travelmaker.mapper.AdminMemberMapper">

	<resultMap type="org.travelmaker.domain.MemberVO"
		id="MemberResult">
		<result property="memNo" column="MEM_NO" />
		<result property="email" column="EMAIL" />
		<result property="nickname" column="NICKNAME" />
		<result property="pwd" column="PWD" />
		<result property="birth" column="BIRTH" />
		<result property="gender" column="GENDER" />
		<result property="regDate" column="REG_DATE" />
		<result property="lastDate" column="LAST_DATE" />
		<result property="status" column="STATUS" />
		<result property="memGrade" column="MEM_GRADE" />
	</resultMap>

	<select id="getUserList" resultMap="MemberResult">
		select /*+ index_desc(member pk_member) */ *
		from member
		<where>
			<choose>
				<when test="type == '닉네임'">
					nickname like '%'||#{keyword}||'%'
				</when>
				<when test="type == '이메일'">
					email like '%'||#{keyword}||'%'
				</when>
				<when test="type == '회원번호'">
					mem_no =#{keyword}
				</when>
			</choose>
		</where>
		order by mem_no desc
	</select>

	<update id="removeUser" parameterType="int[]">
		update member
		set status='탈퇴'
		where mem_no in
		<foreach collection="list" item="id" open="(" close=")" separator=",">
			#{id}
		</foreach>
	</update>

	<select id="getWithdrawUserList" resultMap="MemberResult">
		select /*+ index_desc(member pk_member) */ *
		from member where
		status='탈퇴'
		<trim prefix="and">
		<choose>
				<when test="type == '닉네임'">
					(nickname like '%'||#{keyword}||'%')
				</when>
				<when test="type == '이메일'">
					(email like '%'||#{keyword}||'%')
				</when>
				<when test="type == '회원번호'">
					(mem_no like '%'||#{keyword}||'%')
				</when>
			</choose>
		</trim>
		order by mem_no desc
	</select>
</mapper>