<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.rog//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.travelmaker.mapper.ThemeMapper">

	<resultMap type="org.travelmaker.domain.PlaceDTO"
		id="PlaceResult">
		<result property="themeNo" column="THEME_NO" />
		<result property="plcNo" column="PLC_NO" />
		<result property="plcTitle" column="PLC_TITLE" />
	</resultMap>

	<resultMap type="org.travelmaker.domain.PlaceVO" id="searchResult">
		<result property="plcNo" column="PLC_NO" />
		<result property="regionNo" column="REGION_NO" />
		<result property="plcTitle" column="PLC_TITLE" />
		<result property="lat" column="LAT" />
		<result property="lng" column="LNG" />
		<result property="addressDt" column="ADDRESSDT" />
		<result property="pCate" column="P_CATE" />
		<result property="holiday" column="HOLIDAY" />
		<result property="openingH" column="OPENING_H" />
		<result property="likeCnt" column="LIKECNT" />
	</resultMap>

	<select id="getThemeList" resultType="map">
		select * from theme ORDER BY THEME_NO
	</select>

	<select id="getThemeInfo" resultMap="searchResult">
		SELECT P.PLC_NO, P.PLC_TITLE, P.ADDRESSDT, P.P_CATE, P.LIKECNT
		FROM THEME_PLC T, PLACE P
		WHERE T.PLC_NO = P.PLC_NO AND THEME_NO=#{themeNo}
		ORDER BY P.PLC_TITLE
	</select>

	<delete id="deleteTheme" parameterType="int[]">
		delete
		from theme_plc
		where plc_no in
		<foreach collection="list" item="place" open="(" close=")" separator=",">
			#{place}
		</foreach>
		and theme_no = #{themeNo}
	</delete>
	
	<insert id="insertTheme">
		INSERT ALL 
		<foreach collection="list" item="place">
			INTO THEME_PLC VALUES(#{themeNo},#{place})
		</foreach>
		SELECT * FROM DUAL
	</insert>

	<select id ="getPlaceList" resultMap = "searchResult" parameterType="String">
		SELECT * 
		FROM PLACE
		WHERE PLC_TITLE LIKE '%'||#{keyword}||'%'
		ORDER BY PLC_TITLE
	</select>

</mapper>