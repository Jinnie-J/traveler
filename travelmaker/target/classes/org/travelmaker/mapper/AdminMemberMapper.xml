<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.rog//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.travelmaker.mapper.AdminMemberMapper">
	<resultMap type="org.travelmaker.domain.MemberVO"
		id="MemberResult">
		<result property="memNo" column="MEM_NO" />
		<result property="email" column="EMAIL" />
		<result property="nickname" column="NICKNAME" />
		<result property="pwd" column="PWD" />
		<result property="birth" column="BIRTH" />
		<result property="gender" column="GENDER" />
		<result property="regDate" column="REG_DATE" />
		<result property="lastDate" column="LAST_DATE" />
		<result property="status" column="STATUS" />
		<result property="memGrade" column="MEM_GRADE" />
	</resultMap>

<!-- 	<select id="getUserList" resultMap="MemberResult">
		select /*+ index_desc(member pk_member) */ *
		from member
		<where>
			<choose>
				<when test="type == '닉네임'">
					nickname like '%'||#{keyword}||'%'
				</when>
				<when test="type == '이메일'">
					email like '%'||#{keyword}||'%'
				</when>
				<when test="type == '회원번호'">
					mem_no =#{keyword}
				</when>
			</choose>
		</where>
		order by mem_no desc
	</select> -->
	<select id="getUserList" resultMap="MemberResult">
		select mem_no, email, nickname, pwd, birth, gender, reg_date, last_date, status, code_name as mem_grade
		from(
			select  mem_no, email, nickname, pwd, birth, gender, reg_date, last_date, code_name as status, mem_grade
			from member m, code_table c
			where m.status= concat(c.code_type_id,code)
			<trim prefix="and">	
				<choose>
					<when test="type == '닉네임'">
						(nickname like '%'||#{keyword}||'%')
					</when>
					<when test="type == '이메일'">
						(email like '%'||#{keyword}||'%')
					</when>
					<when test="type == '회원번호'">
						(mem_no =#{keyword})
					</when>
				</choose>
			</trim>
			), code_table c
		where mem_grade = concat(c.code_type_id,code)
		order by mem_no desc
	</select>

	<update id="removeUser" parameterType="int[]">
		update member
		set status='MS002'
		where mem_no in
		<foreach collection="list" item="id" open="(" close=")" separator=",">
			#{id}
		</foreach>
	</update>

<!-- 	<select id="getWithdrawUserList" resultMap="MemberResult">
		select /*+ index_desc(member pk_member) */ *
		from member where
		status='MS002'
		<trim prefix="and">
		<choose>
				<when test="type == '닉네임'">
					(nickname like '%'||#{keyword}||'%')
				</when>
				<when test="type == '이메일'">
					(email like '%'||#{keyword}||'%')
				</when>
				<when test="type == '회원번호'">
					(mem_no like '%'||#{keyword}||'%')
				</when>
			</choose>
		</trim>
		order by mem_no desc
	</select> -->
	
	<select id="getWithdrawUserList" resultMap="MemberResult">
		select mem_no, email, nickname, pwd, birth, gender, reg_date, last_date, status, code_name as mem_grade
		from (select mem_no, email, nickname, pwd, birth, gender, reg_date, last_date, code_name as status, mem_grade
		from member m, code_table c
		where status='MS002' and m.status= concat(c.code_type_id,code)
		<trim prefix="and">
		<choose>
				<when test="type == '닉네임'">
					(nickname like '%'||#{keyword}||'%')
				</when>
				<when test="type == '이메일'">
					(email like '%'||#{keyword}||'%')
				</when>
				<when test="type == '회원번호'">
					(mem_no like '%'||#{keyword}||'%')
				</when>
			</choose>
		</trim>
		), code_table c
		where mem_grade = concat(c.code_type_id,code)
	</select>
</mapper>